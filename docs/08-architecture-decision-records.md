# Architecture Decision Records (ADR)

## ADR-001: Выбор микросервисной архитектуры

**Статус:** Accepted  
**Контекст:**
Приложение предполагает активный рост, высокую нагрузку на ленту, загрузку изображений и независимое развитие функциональности (feed, images, tags, users).

**Решение:**
Архитектура построена на основе микросервисов, где каждый сервис отвечает за отдельный бизнес-домен.

**Причины:**
- Независимое масштабирование сервисов (feed и images масштабируются сильнее остальных)
- Возможность автономной разработки и деплоя
- Четкое разделение доменных областей

**Последствия:**
- Увеличение операционной сложности (observability, deployment)
- Необходимость управления сетевыми взаимодействиями и отказоустойчивостью

---

## ADR-002: Database per Service

**Статус:** Accepted  

**Контекст:**
Совместное использование базы данных между сервисами приводит к сильной связности и проблемам при изменениях схемы.

**Решение:**
Каждый микросервис владеет своей собственной базой данных PostgreSQL.

**Причины:**
- Полная автономия сервисов
- Возможность оптимизировать схему БД под конкретные нагрузки
- Упрощение контроля целостности данных внутри сервиса

**Последствия:**
- Отсутствие транзакций между сервисами
- Необходимость eventual consistency

---

## ADR-003: API Gateway

**Статус:** Accepted  

**Контекст:**
Клиентское приложение не должно знать о внутренней структуре микросервисов.

**Решение:**
Введён API Gateway как единая точка входа для Web-приложения.

**Обязанности API Gateway:**
- Маршрутизация запросов
- Проверка JWT / OAuth токенов
- Rate limiting
- Request aggregation (опционально)

**Последствия:**
- Потенциальная точка отказа (решается горизонтальным масштабированием)
- Дополнительный hop в сети

---

## ADR-004: Event-Driven Architecture

**Статус:** Accepted  

**Контекст:**
Синхронные вызовы между сервисами усиливают связность и ухудшают отказоустойчивость.

**Решение:**
Используется асинхронное взаимодействие через message broker (Kafka / NATS).

**Примеры событий:**
- ImageUploaded
- TagsUpdated
- UserProfileUpdated

**Причины:**
- Снижение coupling между сервисами
- Повышение устойчивости к сбоям
- Возможность добавлять новых consumer-ов без изменения producer-ов

**Последствия:**
- Eventual consistency
- Сложность отладки и трассировки

---

## ADR-005: OAuth для аутентификации пользователей

**Статус:** Accepted  

**Контекст:**
Реализация собственной системы аутентификации увеличивает риски безопасности.

**Решение:**
User Service использует сторонние OAuth-провайдеры (Google и аналоги).

**Причины:**
- Повышение безопасности
- Упрощение UX
- Снижение времени разработки

**Последствия:**
- Зависимость от third-party сервисов
- Необходимость обработки edge-case сценариев (revoked tokens, outages)

---

## ADR-006: React SPA как клиентское приложение

**Статус:** Accepted  

**Контекст:**
Приложение ориентировано на визуальный контент и динамическое взаимодействие.

**Решение:**
Используется React SPA, взаимодействующее с backend через API Gateway.

**Причины:**
- Высокая интерактивность UI
- Богатая экосистема
- Четкое разделение frontend / backend

**Последствия:**
- SEO требует дополнительной проработки (SSR / prerender)
- Вся безопасность — на backend стороне

