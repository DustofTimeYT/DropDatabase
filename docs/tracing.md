# Трассировка требований

### От бизнес-целей к функциональным требованиям

| Бизнес-цель                                                                                              | Поддерживающие функциональные требования                                                                                                                                 | Как ФТ поддерживает БЦ                                                                                                                                                                |
|----------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **1. Достичь аудитории свыше 1 млн пользователей за год**                                                | Создать аккаунт<br>Войти в аккаунт<br>Создать публикацию<br>Прикрепить изображения<br>Назначить тег<br>Добавить описание<br>Искать по тегам<br>Подбирать аналогичные изображения<br>Добавить в понравившиеся<br>Скачать изображение<br>Уведомить о комментарии<br>Уведомить об upvote<br>Проводить минимум один конкурс в неделю | Базовый функционал для регистрации и создания контента<br>Поиск и рекомендации помогают находить новый контент<br>Уведомления и конкурсы стимулируют привлечение       |
| **2. Получать 1 млн рублей/мес. через рекламу**                                                         | Отображать контекстную рекламу<br>Настройка параметров рекламы<br>Сбор и отображение статистики                                                                         | Прямой механизм монетизации<br>Оптимизация эффективности рекламных показов                                                                                                            |
| **3. Повысить retention более чем на 40% за 30 дней**                                                    | Уведомить о комментарии<br>Уведомить об upvote<br>Уведомить о результатах конкурса<br>Подбирать аналогичные изображения<br>Добавить в понравившиеся<br>Искать по тегам<br>Добавить комментарий<br>Проводить минимум один конкурс в неделю | Уведомления возвращают пользователей<br>Персонализация контента повышает ценность сервиса<br>Социальные взаимодействия создают поводы для возврата                                     |
| **4. Внедрить рекомендательную систему с CTR ≥5%**                                                      | Подбирать аналогичные изображения<br>Сбор и отображение статистики                                                                                                       | Ядро рекомендательной системы<br>Измерение эффективности рекомендаций                                                                                                                 |
| **5. Выйти на СНГ рынок к концу второго года**                                                           | *(Требуются доп. ФТ: локализация, региональные платежи)*                                                                                                                 | Текущие ФТ не покрывают требования локализации                                                                                                                                       |
| **6. Достичь доли платящих пользователей ≥3% от MAU**                                                    | Выдать подписку<br>Продлить подписку<br>Отменить подписку<br>Принять донат                                                                                               | Техническая возможность для монетизации                                                                                                                                              |
| **7. Достичь среднего времени сессии ≥8 минут**                                                          | Искать по тегам<br>Подбирать аналогичные изображения<br>Добавить в понравившиеся<br>Скачать изображение<br>Добавить комментарий<br>Создать альбом<br>Редактировать альбом<br>Добавить изображения в альбом<br>Проводить конкурсы | Продлевают взаимодействие с контентом<br>Интерактивные действия увеличивают длительность сессии<br>Конкурсы требуют времени для участия                                              |
| **8. Проводить минимум один конкурс в неделю с участием >15% от MAU**                                    | Создать конкурс<br>Сформировать список победителей<br>Наградить победителей<br>Уведомить о результатах<br>Отправить картинку<br>Отобразить результаты                     | Организация конкурсов и управление процессом<br>Техническая возможность участия<br>Информирование поддерживает вовлеченность                                                          |

### От требований заинтересованных лиц к сценариям использования

| Требование заинтересованного лица      | Связанные сценарии использования                          | Обоснование связи                                                                 |
|---------------------------------------|----------------------------------------------------------|-----------------------------------------------------------------------------------|
| **Делать публикации**                 | Пользователь: Создать публикацию                         | Прямая реализация функционала создания контента                                   |
| **Удалять публикацию**                | Пользователь: Удалить публикацию<br>Модератор: Удалить публикацию пользователя | Покрывает удаление как владельцем, так и администратором                         |
| **Получать уведомления**              | *(Не покрыто)*                                          | Требуется новый сценарий (напр. "Обработка уведомлений")                          |
| **Группировать изображения в альбом** | *(Не покрыто)*                                          | Отсутствует сценарий создания/управления альбомами                               |
| **Искать изображения**                | *(Не покрыто)*                                          | Нет сценария поиска контента                                                      |
| **Добавлять в понравившиеся**         | *(Не покрыто)*                                          | Отсутствует сценарий работы с избранным                                           |
| **Скачивать изображение**             | *(Не покрыто)*                                          | Нет сценария загрузки контента                                                    |
| **Пожаловаться на контент**           | *(Не покрыто)*                                          | Требуется сценарий "Отправить жалобу"                                             |
| **Участвовать в конкурсе**            | *(Частично)* Контент-креатор: Создать конкурс           | Нет сценария участия пользователей (только создания конкурсов)                   |
| **Оформлять подписку**                | Пользователь: Оформить подписку                         | Прямая реализация подписки                                                        |
| **Оценивать публикацию**              | *(Не покрыто)*                                          | Нет сценария upvote/рейтинга контента                                             |
| **Иметь аккаунт**                     | Пользователь: Запросить удаление аккаунта               | Частичное покрытие (не хватает регистрации и входа)                              |
| **Поддержать разработчиков**          | *(Не покрыто)*                                          | Нет сценария приема донатов                                                       |
| **Размещать рекламу**                 | Рекламодатель: Разместить рекламу                       | Прямая реализация размещения рекламных материалов                                 |
| **Получать статистику о рекламе**     | Рекламодатель: Отобразить статистику                    | Прямая реализация аналитики рекламных кампаний                                    |
| **Блокировать пользователя**          | Модератор: Заблокировать аккаунт                        | Прямая реализация блокировки аккаунтов                                            |
| **Удалять комментарий (модератор)**   | *(Не покрыто)*                                          | Нет отдельного сценария для комментариев                                          |
| **Просматривать список жалоб**        | *(Не покрыто)*                                          | Нет сценария работы с жалобами                                                    |
| **Проводить конкурсы**                | Контент-креатор: Создать конкурс<br>Контент-креатор: Наградить победителя | Полное покрытие жизненного цикла конкурса                                         |

### От атрибутов качества к архитектурным решениям

1. Доступность (99.95%):
    - Микросервисы: Каждый сервис развертывается в 3+ AZ
    - Redis: Sentinel mode с автоматическим failover
    - API Gateway: Health checks + автоматическое исключение нерабочих нод
    - Пример: При падении Auth-сервиса Gateway перенаправляет запросы на резервный регион

2. Надежность (MTTR ≤15 мин):
    - gRPC: Автоматические retry с экспоненциальным откатом
    - Redis: Async replication + дисковое сохранение данных
    - Метрика: Репликация данных между ЦОД с RPO <1 мин

3. Производительность (500 мс p95):
    - Redis: Кэширование ответов БД (cache-hit ratio >85%)
    - gRPC: Бинарные протоколы (экономия 30-50% vs JSON)
    - SPA: Кэширование статики на CDN (Edge locations
    - Бенчмарк: 1200 RPS на инстанс при 32 vCPU

4. Масштабируемость (1→10 экз.):
    - Микросервисы: Автоскейлинг по CPU/RAM (HPA в Kubernetes)
    - API Gateway: Round-robin балансировка с учетом загрузки
    - Сценарий: Пиковая нагрузка конкурсов → масштабирование Contest Service

5. Расширяемость (3 дня на фичу):
    - Микросервисы: Новая рекомендательная система как отдельный сервис
    - gRPC: Версионирование proto-контрактов
    - Пример: Добавление видео-форматов без изменения core-сервисов

6. Безопасность (OWASP Top 10):
    - External IdP: OAuth 2.0 + MFA + аудит доступа
    - API Gateway: Защита от DDoS, инъекций и XSS
    - Архитектура: Zero-trust сеть между микросервисами (mTLS)
    - Комплаенс: Шифрование PII в Redis (AES-256-GCM)

### Трассировка данных

| Сценарий использования                     | Задействованные сущности              | Операции с данными                                                                 |
|-------------------------------------------|---------------------------------------|-----------------------------------------------------------------------------------|
| **Пользователь: Создать публикацию**      | Пользователь, Публикация, Изображение | Создание: Публикация, Изображение<br>Обновление: Пользователь (статистика)        |
| **Пользователь: Удалить публикацию**      | Пользователь, Публикация, Изображение | Удаление: Публикация<br>Обновление: Изображение (ссылки), Пользователь (статистика)|
| **Пользователь: Оформить подписку**       | Пользователь, Подписка, Тип подписки  | Создание: Подписка<br>Чтение: Тип подписки<br>Обновление: Пользователь (статус)   |
| **Пользователь: Запросить удаление аккаунта** | Пользователь, Подписка, Публикация | Обновление: Пользователь (статус)<br>Удаление: Подписка<br>Каскадное удаление: Публикация |
| **Модератор: Удалить публикацию**         | Модератор, Публикация, Пользователь   | Удаление: Публикация<br>Обновление: Пользователь (репутация)<br>Создание: Уведомление |
| **Модератор: Заблокировать аккаунт**      | Модератор, Пользователь               | Обновление: Пользователь (статус блокировки)<br>Создание: Уведомление             |
| **Контент-креатор: Создать конкурс**      | Контент-креатор, Соревнование         | Создание: Соревнование<br>Обновление: Контент-креатор (активность)                |
| **Контент-креатор: Наградить победителя** | Контент-креатор, Соревнование, Пользователь | Обновление: Соревнование (статус)<br>Обновление: Пользователь (награды)<br>Создание: Уведомление |
| **Рекламодатель: Разместить рекламу**     | Рекламодатель, Реклама                | Создание: Реклама<br>Обновление: Рекламодатель (баланс)                           |
| **Рекламодатель: Отобразить статистику**  | Рекламодатель, Реклама, Пользователь  | Чтение: Реклама (показы, клики)<br>Анализ: Пользователь (демография)              |